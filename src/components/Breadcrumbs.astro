---
interface BreadcrumbItem {
  name: string;
  href?: string;
}

interface Props {
  items?: BreadcrumbItem[];
  className?: string;
}

const { items, className = '' } = Astro.props;

// Auto-generate breadcrumbs from URL path if not provided
const currentPath = Astro.url.pathname;

function generateBreadcrumbs(): BreadcrumbItem[] {
  if (items && items.length > 0) return items;
  
  // Don't show breadcrumbs on homepage
  if (currentPath === '/' || currentPath === '') {
    return [];
  }
  
  const pathSegments = currentPath.split('/').filter(Boolean);
  const breadcrumbs: BreadcrumbItem[] = [
    { name: 'Home', href: '/' }
  ];
  
  let currentHref = '';
  
  pathSegments.forEach((segment, index) => {
    currentHref += `/${segment}`;
    const isLast = index === pathSegments.length - 1;
    
    // Format segment name: kebab-case to Title Case
    const name = segment
      .split('-')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
    
    breadcrumbs.push({
      name,
      href: isLast ? undefined : currentHref
    });
  });
  
  return breadcrumbs;
}

const breadcrumbItems = generateBreadcrumbs();

// Generate BreadcrumbList structured data
const breadcrumbSchema = breadcrumbItems.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbItems.map((item, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": item.name,
    ...(item.href && { "item": `https://leadflownorth.com${item.href}` })
  }))
} : null;
---

{breadcrumbItems.length > 1 && (
  <nav 
    class={`py-3 ${className}`}
    aria-label="Breadcrumb"
  >
    <div class="container mx-auto px-4 sm:px-6">
      <ol 
        class="flex flex-wrap items-center gap-1 text-sm text-slate-500 dark:text-slate-400"
        itemscope 
        itemtype="https://schema.org/BreadcrumbList"
      >
        {breadcrumbItems.map((item, index) => (
          <li 
            class="flex items-center"
            itemprop="itemListElement" 
            itemscope 
            itemtype="https://schema.org/ListItem"
          >
            {index > 0 && (
              <svg 
                class="w-4 h-4 mx-2 text-slate-300 dark:text-slate-600 flex-shrink-0" 
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
              >
                <path 
                  stroke-linecap="round" 
                  stroke-linejoin="round" 
                  stroke-width="2" 
                  d="M9 5l7 7-7 7"
                />
              </svg>
            )}
            {item.href ? (
              <a 
                href={item.href} 
                class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
                itemprop="item"
              >
                <span itemprop="name">{item.name}</span>
              </a>
            ) : (
              <span 
                class="text-slate-700 dark:text-slate-300 font-medium truncate max-w-[200px]"
                itemprop="name"
              >
                {item.name}
              </span>
            )}
            <meta itemprop="position" content={String(index + 1)} />
          </li>
        ))}
      </ol>
    </div>
    
    {/* Inject breadcrumb structured data */}
    {breadcrumbSchema && (
      <script is:inline type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
    )}
  </nav>
)}
